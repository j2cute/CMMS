@model ClassLibrary.ViewModels.PartsViewModels
<link href="~/Content/morris.css" rel="stylesheet" />
<link href="~/Content/Digtalstyle.css" rel="stylesheet" />
<script src="~/Content/Digitalscript.js"></script>
<script src="~/Scripts/moment.min.js"></script>
<link href="~/Scripts/themes/default/style.min.css" rel="stylesheet" />
<script src="~/Scripts/jstree.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<link href="~/Content/select.dataTables.min.css" rel="stylesheet" />
<script src="~/Scripts/dataTables.select.min.js"></script>

<style>
    .modal-dialog {
        width: 80% !important;
    }

    .avatar-preview {
        width: 192px;
        height: 192px;
        position: relative;
        border: 6px solid #F8F8F8;
        box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
    }
    a {
        cursor: pointer;
    }
    .selected td {
        background-color: #3c8dbc !important;
    }

    td {
        font-size: 11px !important;
    }
</style>

<!-- Main content -->
<section class="content" style="min-height:0px !important">
    <input type="hidden" name="parentPartId" id="parentPartId" />
    <!-- Small boxes (Stat box) -->
    <div class="row" id="ConfigEquipment">
        <div class="col-md-7">
            <div class="row" id="ConfigBox" style="margin-right:0px">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">Parts</h3>
                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                <i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-12">


                                <table id="example1" class="display" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Part Id</th>
                                            <th>Part No</th>
                                            <th>Cage Code</th>
                                            <th>Part Name</th>
                                            <th>Manufacturer</th>


                                        </tr>
                                    </thead>
                                    <tbody>
                                        @*@if (Model.tbl_Parts_list != null)
                                            {*@

                                        @foreach (var item in Model.tbl_Parts_list)
                                        {
                                            <tr>
                                                <td></td>
                                                <td> @item.PartId</td>
                                                <td> @item.Part_No</td>
                                                <td> @item.CageCode</td>
                                                <td> @item.PART_NAME</td>

                                                <td> @item.tbl_Cage.CageName</td>



                                            </tr>
                                        }

                                    </tbody>
                                </table>


                                <br />

                            </div>
                        </div>

                    </div>


                </div>
            </div>

        </div>

        @*Eswbs Detail- Start*@
        <div class="col-md-5" id="AllDetails">
            <div class="row" id="ConfigBox" style="margin-right:0px">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">Child Parts</h3>
                        <div class="box-tools pull-right">
                            <a data-toggle="modal" data-target="#addMOP" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> Add New Child Part</a>

                            <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                <i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-12">


                                <table id="childTable" class="display" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Part Id</th>
                                            <th>Child Part Id</th>
                                            <th>Part Name</th>
                                            <th>Part No.</th>
                                            <th>Qty</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>

                                </table>


                                <br />

                            </div>


                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>
</section>


<div id='addMOP' class='modal fade'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id='myModalContent'>

                <div class="modal-header">
                    <h4 class="modal-title">Add</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>


                <div class="modal-body">
                    @*@Html.HiddenFor(model => model.C_Site_Config.Part_No)
                        @Html.HiddenFor(model => model.C_Site_Config.CageCode)*@
                    <div class="box box-primary box-solid">
                        <div class="box-header with-border">
                            <h3 class="box-title"><b>Add MOP</b></h3>
                        </div>
                        <br />

                        <!-- /.card-header -->
                        <!-- form start -->
                        <div class="box-body" id="InputFields">
                            <div class="row">
                                @Html.HiddenFor(model => model.tbl_ChildParts.ChildPartId)
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Parent Id</label>

                                        @Html.EditorFor(model => model.tbl_ChildParts.ParentPartId, new { htmlAttributes = new { @class = "form-control", @readonly = true, @required = "true" } })
                                        @Html.ValidationMessageFor(model => model.tbl_ChildParts.ParentPartId, "", new { @class = "text-danger" })

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Qty</label>

                                        @Html.EditorFor(model => model.tbl_ChildParts.Qty, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.tbl_ChildParts.Qty, "", new { @class = "text-danger" })

                                    </div>
                                </div>
                            </div>

                            <br />
                            <table id="addPartsTable" class="display" style="width:100%">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Part Id</th>
                                        <th>Part No</th>
                                        <th>Cage Code</th>
                                        <th>Part Name</th>
                                        <th>Manufacturer</th>


                                    </tr>
                                </thead>
                                <tbody>


                                    @foreach (var item in Model.tbl_Parts_list)
                                    {
                                    <tr>
                                        <td></td>
                                        <td> @item.PartId</td>
                                        <td> @item.Part_No</td>
                                        <td> @item.CageCode</td>
                                        <td> @item.PART_NAME</td>
                                        <td> @item.tbl_Cage.CageName</td>



                                    </tr>
                                    }

                                </tbody>
                            </table>


                        </div>

                    </div>

                    <div class="box-footer" id="footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <input type="button" onclick="AddChildData()" value="Submit" class="btn btn-primary pull-right" />
                    </div>


                </div>


            </div>
        </div>
    </div>
</div>

<div id="editMOP" class='modal fade'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id='myModalContent'>

                <div class="modal-header">
                    <h4 class="modal-title">Edit</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>


                <div class="modal-body">
                    @*@Html.HiddenFor(model => model.C_Site_Config.Part_No)
                        @Html.HiddenFor(model => model.C_Site_Config.CageCode)*@
                    <div class="box box-primary box-solid">
                        <div class="box-header with-border">
                            <h3 class="box-title"><b>Edit MOP</b></h3>
                        </div>
                        <br />

                        <!-- /.card-header -->
                        <!-- form start -->
                        <div class="box-body" id="InputFields">

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Parent Id</label>

                                        @Html.EditorFor(model => model.ChildPartsModel.ParentPartId, new { htmlAttributes = new { @class = "form-control", @readonly = true, @required = "true" } })
                                        @Html.ValidationMessageFor(model => model.ChildPartsModel.ParentPartId, "", new { @class = "text-danger" })

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Child Part Id</label>

                                        @Html.EditorFor(model => model.ChildPartsModel.ChildPartId, new { htmlAttributes = new { @class = "form-control", @readonly = true, @required = "true" } })
                                        @Html.ValidationMessageFor(model => model.ChildPartsModel.ChildPartId, "", new { @class = "text-danger" })

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Qty</label>

                                        @Html.EditorFor(model => model.ChildPartsModel.Qty, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.ChildPartsModel.Qty, "", new { @class = "text-danger" })

                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                    <div class="box-footer" id="footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <input type="button" onclick="EditChildData()" value="Submit" class="btn btn-primary pull-right" />
                    </div>


                </div>


            </div>
        </div>
    </div>
</div>

<div id='delMOP' class='modal fade'>
    <div class="modal-dialog modal-lg" style="width: 40% !important;">
        <div class="modal-content">
            <div id='myModalContent'>

                <div class="modal-header">
                    <h4 class="modal-title"><b>Confirm Delete</b></h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <h3 style="color:red">Are you sure you want to delete this?</h3>
                </div>
                <div class="modal-footer">
                    <div class="form-actions no-color">
                        <button class="btn btn-default" data-dismiss="modal">Close</button>
                        <input type="submit" onclick="DeleteChildData()" value="Delete" class="btn btn-danger" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    @Scripts.Render("~/Scripts/Common/ModalPopup.js")
}

<script>
    function AddChildData() {
        $.ajax({
            cache: 'false',
            type: "Post",
            url: '@Url.Action("AddChildPart", "Parts")',
            dataType: 'json',
            data: {
                ParentPartId: $('#tbl_ChildParts_ParentPartId').val(),
                ChildPartId: $('#tbl_ChildParts_ChildPartId').val(),
                Qty: $('#tbl_ChildParts_Qty').val(),
            },
            success: OnSuccess,
            failure: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });
            },
            error: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });
            }
        });
    };
    function EditChildData() {
        $.ajax({
            cache: 'false',
            type: "Post",
            url: '@Url.Action("EditChildPart", "Parts")',
            dataType: 'json',
            data: {
                ParentPartId: $('#ChildPartsModel_ParentPartId').val(),
                ChildPartId: $('#ChildPartsModel_ChildPartId').val(),
                Qty: $('#ChildPartsModel_Qty').val(),
            },
            success: OnSuccess,
            failure: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });

            },
            error: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });

            }
        });
    };
    function DeleteChildData() {
        var childPartId = $('#ChildPartsModel_ChildPartId').val();
        var parentPartId = $('#ChildPartsModel_ParentPartId').val();
        $.ajax({
            cache: 'false',
            type: "Post",
            url: '@Url.Action("DeleteChildPart", "Parts")',
            dataType: 'json',
            data: {
                childPartId: childPartId,
                parentPartId: parentPartId
            },
            success: OnSuccess,
            failure: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });
            },
            error: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });

            }
        });
    };

</script>

<script>
    var table;
    var addPartsTable;
    $(document).ready(function () {

        table = $('#example1').DataTable({
            'columnDefs': [{
                targets: 0,
                data: null,
                defaultContent: '',
                orderable: false,
                className: 'select-checkbox'
            }],
            select: {
                style: 'os',
                selector: 'td:first-child'
            },
            order: [[1, 'asc']]
        });

        $('#example1 tbody').on("click", '.select-checkbox', function () {
            var tblData = table.rows($(this).closest('tr')).data();
            var selectedData;
            $.each(tblData, function (i, val) {
                selectedData = tblData[i];
            });
            console.log(selectedData);
            var parentPartId = selectedData[1];
            $('#parentPartId').val(parentPartId);
            //for add
            $('#tbl_ChildParts_ParentPartId').val(parentPartId);
            GetSelectedData();
        });

        addPartsTable = $('#addPartsTable').DataTable({
            'columnDefs': [{
                targets: 0,
                data: null,
                defaultContent: '',
                orderable: false,
                className: 'select-checkbox'
            }],
            select: {
                style: 'os',
                selector: 'td:first-child'
            },
            order: [[1, 'asc']]
        });

        $('#addPartsTable tbody').on("click", '.select-checkbox', function () {
            var tblData = addPartsTable.rows($(this).closest('tr')).data();
            var selectedData;
            $.each(tblData, function (i, val) {
                selectedData = tblData[i];
            });
            console.log(selectedData);
            var childPartId = selectedData[1];
            $('#tbl_ChildParts_ChildPartId').val(childPartId);
            alert(childPartId);
            //for add
           // $('#tbl_ChildParts_ParentPartId').val(parentPartId);
        });
    });
</script>

<script>
    var childTable;
        function GetSelectedData() {
            var parentPartId = $('#parentPartId').val();

        $.ajax({
                cache: 'false',
                type: "Post",
                // contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetSelectedData", "Parts")',

            dataType: 'json',  // add this line
            data: {
                parentPartId: parentPartId,
            },
            success: OnSuccess,
            failure: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });
            },
            error: function (response) {
                swal({ title: "ERROR", text: "Their is something went wrong!!!", type: "error", });
            },
        });

    };
        function OnSuccess(response) {
        $("#addMOP").modal('hide'); $("#editMOP").modal('hide'); $("#delMOP").modal('hide');
        $("#childTable").DataTable().destroy();
        childTable = $("#childTable").DataTable(
            {
                scrollX: true,
                bLengthChange: true,
                lengthMenu: [[5, 10, -1], [5, 10, 15, "All"]],
                bFilter: true,
                bSort: true,
                bPaginate: true,
                data: response,

                columns: [
                    { 'data': 'ParentPartId' },
                    { 'data': 'ChildPartId' },
                    { 'data': 'ChildPartNo' },
                    { 'data': 'ChildPartName' },
                    { 'data': 'Qty' },

                    {
                        'data': function (data, type, row, meta) {
                            return '<a data-toggle="modal" data-target="#editMOP"  class="btn-primary btn-sm select">' + 'Edit' + '</a>' + '|' + '<a data-toggle="modal"  data-target="#delMOP"  class="btn-danger btn-sm select">' + 'Delete' + '</a>'
                        }


                    },
                ]

            });
        if (!$.trim(response)) {
            swal({
                title: "Oops...", text: "No childs Found!", type: "error",
            });
        }
        else {
            swal({
                title: "¡Success!", type: "success", timer: 1500, showConfirmButton: false,
            });
        }
        $('#childTable tbody').on("click", '.select', function () {
            var tblData = childTable.rows($(this).closest('tr')).data();
            console.log(tblData);

            var parentPartId = $(this).closest('tr').find("td:eq(0)").text();
            var childPartId = $(this).closest('tr').find("td:eq(1)").text();
            var qty = $(this).closest('tr').find("td:eq(4)").text();
            //forEdit
            $('#ChildPartsModel_ParentPartId').val(parentPartId);
            $('#ChildPartsModel_ChildPartId').val(childPartId);
            $('#ChildPartsModel_Qty').val(qty);
        });
    };
</script>


