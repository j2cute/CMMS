@model ClassLibrary.ViewModels.ConfigViewModel
<link href="~/Content/morris.css" rel="stylesheet" />
<link href="~/Content/Digtalstyle.css" rel="stylesheet" />
<script src="~/Content/Digitalscript.js"></script>
<script src="~/Scripts/moment.min.js"></script>
<script src="~/Scripts/raphael.min.js"></script>
<script src="~/Scripts/morris.min.js"></script>
<style>
    .modal-dialog {
        width: 80% !important;
    }

    .avatar-preview {
        width: 192px;
        height: 192px;
        position: relative;
        border: 6px solid #F8F8F8;
        box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
    }

</style>
<section class="content-header">
    <h1>
        Inbox

    </h1>

</section>
<!-- Main content -->
<section class="content">

    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header">
             <h4>Equipment Requests</h4>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <table id="example1" class="table table-bordered table-striped" style="width:100%">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Request Id</th>
                                <th>Unit</th>
                                <th>Equipment Name</th>
                                <th>Manufacturer Name</th>
                      
                                @*<th>MCAT</th>
                                    <th>Unit Price</th>
                                    <th>Currency</th>
                                    <th>MTBF</th>
                                    <th>BRF</th>
                                    <th>SMR</th>*@
                                @*<th>Length</th>
                                    <th>Width</th>
                                    <th>Height</th>
                                    <th>Diameter</th>
                                    <th>Weight</th>*@
                               
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.tbl_Request_list)
                            {
                                <tr>
                                    @{
                                        if (this.User.IsInRole("Admin"))
                                        {
                                            <td>
                                                <input data-toggle="modal" data-target="#GetRequestFormModal"  type="button" value="View" class="btn btn-info btn-sm GetId" />

                                            </td> }
                                        else
                                        {
                                            <td>
                                                <input data-toggle="modal" data-target="#GetRequestFormModal"  type="button" value="View" class="btn btn-info btn-sm GetId" />
</td>
                                       }
                                    }
                                    <td> @item.RequestId</td>
                                    <td> @item.UNIT_PRICE</td>
                                    <td> @item.Equipment_Name</td>
                                    <td> @item.ManufacturerName</td>
                 
                                    @*<td> @item.tbl_MCAT.MCAT_Name</td>
                                        <td> @item.UNIT_PRICE</td>
                                        <td> @item.CurrencyID</td>
                                        <td> @item.MTBF</td>
                                        <td> @item.BRF</td>
                                        <td> @item.SMR</td>*@
                                    @*<td> @item.LENGTH</td>
                                        <td> @item.WIDTH</td>
                                        <td> @item.HEIGHT</td>
                                        <td> @item.WEIGHT</td>*@


                                  
                                </tr>
                                        }
                        </tbody>
                    </table>


                </div>
                <!-- /.box-body -->
            </div>

        </div>

    </div>

</section>



<input id="requestId" type="hidden" />
<div id='GetRequestFormModal' class='modal fade'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id='myModalContent'>

                <div class="modal-header">
                    <h4 class="modal-title">Registration</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>


                <div class="modal-body">
                    <div class="box">          
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title"><b> Equipment Registration Form</b></h3>
                                </div>
                                <br />
                                @Html.HiddenFor(model => model.tbl_Request.RequestId)
                                <!-- /.card-header -->
                                <!-- form start -->
                                <div class="box-body" id="InputFields">
                                    <div class="row">
                                        <div class="col-md-9">
                                            <div class="row">


                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Part No</label>

                                                        @Html.EditorFor(model => model.tbl_Request.Part_No, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.Part_No, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Equipment Name</label>

                                                        @Html.EditorFor(model => model.tbl_Request.Equipment_Name, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.Equipment_Name, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>PMS No.</label>

                                                        @Html.EditorFor(model => model.tbl_Request.PMS_No, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.PMS_No, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>NSN</label>

                                                        @Html.EditorFor(model => model.tbl_Request.NSN, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.NSN, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Country</label>

                                                        @Html.DropDownListFor(model => model.tbl_Request.Country, new SelectList(Model._tbl_Country, "CountryName", "CountryName"), "Select", new { @class = "form-control", @required = "true" })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.Country, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Manufacturer Name</label>
                                                        @Html.EditorFor(model => model.tbl_Request.ManufacturerName, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.ManufacturerName, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>



                                            </div>

                                            <div class="row">
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Cage Code</label>
                                                        @Html.EditorFor(model => model.tbl_Request.CageCode, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.CageCode, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Qty</label>

                                                        @Html.EditorFor(model => model.tbl_Request.Qty, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.Qty, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Unit Price</label>

                                                        @Html.EditorFor(model => model.tbl_Request.UNIT_PRICE, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.UNIT_PRICE, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>

                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Currency</label>

                                                        @Html.DropDownListFor(model => model.tbl_Request.CurrencyID, new SelectList(Model._tbl_Currency, "CurrencyID", "CurrencyName"), "Select", new { @class = "form-control" })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.CurrencyID, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>MTBF</label>

                                                        @Html.EditorFor(model => model.tbl_Request.MTBF, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.MTBF, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>BRF</label>

                                                        @Html.EditorFor(model => model.tbl_Request.BRF, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.BRF, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="col-md-3">

                                            <div class="picture-container">
                                                <div class="picture">
                                                    <img src="~/Content/Img/default-avatar.png" class="avatar-preview" id="WizardPicturePreview" title="" />
                                                    @Html.TextBoxFor(model => model.FileHelper.File, new { type = "file", @class = "form-control", @id = "File" })
                                                    @Html.ValidationMessageFor(model => model.FileHelper.File, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-9">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Location(s)</label>

                                                        @Html.EditorFor(model => model.tbl_Request.LOCATIONS, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.LOCATIONS, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Serial No(s) <span style="font-size:smaller;color:darkgray;">If multiple separated by commas</span></label>

                                                        @Html.EditorFor(model => model.tbl_Request.SERIAL_NO, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.tbl_Request.SERIAL_NO, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Date of Installation</label>

                                                @Html.EditorFor(model => model.tbl_Request.DateOfInstallation, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.tbl_Request.DateOfInstallation, "", new { @class = "text-danger" })

                                            </div>
                                        </div>
                                    </div>
                                    <fieldset>
                                        <legend>DIMENSIONS</legend>
                                        <div class="row">
                                            <div class="col-md-1"></div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Length(cm)</label>

                                                    @Html.EditorFor(model => model.tbl_Request.LENGTH, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.LENGTH, "", new { @class = "text-danger" })

                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Width(cm)</label>

                                                    @Html.EditorFor(model => model.tbl_Request.WIDTH, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.WIDTH, "", new { @class = "text-danger" })

                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Height(cm)</label>

                                                    @Html.EditorFor(model => model.tbl_Request.HEIGHT, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.HEIGHT, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Diameter(cm)</label>

                                                    @Html.EditorFor(model => model.tbl_Request.DIAMETER, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.DIAMETER, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label>Weight(kg)</label>

                                                    @Html.EditorFor(model => model.tbl_Request.WEIGHT, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.WEIGHT, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                            <div class="col-md-1"></div>
                                        </div>
                                    </fieldset>
                                    <fieldset>

                                        <legend style="font-size:large">EQUIPMENT CHARACTERISTICS</legend>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    @Html.TextAreaFor(model => model.tbl_Request.PART_CHARACTERISTIC, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.PART_CHARACTERISTIC, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </fieldset>



                                    <div class="row">
                                        <div class="col-md-6">
                                            <fieldset>
                                                <legend style="font-size:large">JUSTIFICATION</legend>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            @Html.TextAreaFor(model => model.tbl_Request.JUSTIFICATION, new { htmlAttributes = new { @class = "form-control" } })
                                                            @Html.ValidationMessageFor(model => model.tbl_Request.JUSTIFICATION, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                        <div class="col-md-6">
                                            <fieldset>
                                                <legend style="font-size:large">DETAIL REMARKS</legend>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            @Html.TextAreaFor(model => model.tbl_Request.DETAIL_REMARKS, new { htmlAttributes = new { @class = "form-control" } })
                                                            @Html.ValidationMessageFor(model => model.tbl_Request.DETAIL_REMARKS, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col-md-6"></div>
                                        <div class="col-md-6">
                                            <div class="form-group">

                                                <label class="col-md-3">Name:</label>
                                                <div class="col-md-9">
                                                    @Html.EditorFor(model => model.tbl_Request.NAME, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.NAME, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group">
                                                <label class="col-md-3">Designation:</label>
                                                <div class="col-md-9">
                                                    @Html.EditorFor(model => model.tbl_Request.DESIGNATION, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.DESIGNATION, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group">
                                                <label class="col-md-3">Contact No.:</label>
                                                <div class="col-md-9">
                                                    @Html.EditorFor(model => model.tbl_Request.CONTACT, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.tbl_Request.CONTACT, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="box-footer" id="footer">
                       
                                <input type="submit"  id="return" value="Return" class="btn btn-primary"/>
                                <input type="submit" onclick="RegisterRequest()" value="Register" class="btn btn-success pull-right" />
                            </div>
                        
                        <div class="returnDiv">
                            <div class="col-md-12">
                                <br />
                                <span>
                                    <b>
                                        Please Enter Remarks and Submit
                                    </b> <b><a href="#" onclick="hideDiv()" style="float: right;">CLOSE</a> </b>
                                </span>
                                <input type="text" id="remarks" />
                                <br /><br />
                                <input type="submit" onclick="ReturnReq()" value="submit" class="btn btn-primary btn-sm" />


                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
<script>
    $("#return").click(function () {
        $('.returnDiv').show();
        $('#remarks').focus();
    });
    function hideDiv() {
        $('.returnDiv').hide();
        $('#remarks').val("");
    };

    function ValidateRemarks() {
        if ($("#remarks").val().trim().length == 0) {
            alert('Please provide remarks');
            $("#remarks").focus();
            return false;
        }
        else {

            return true;
        }

    }
</script>
<script>

    $(document).ready(function () {
        $('.returnDiv').hide();

        var table = $('#example1').DataTable({
            "scrollX": true,
        });

        $('#example1 .GetId').on("click", function () {
            var tblData = table.rows($(this).closest('tr')).data();
            console.log(tblData);
            var selectedData;
            $.each(tblData, function (i, val) {
                selectedData = tblData[i];
            });
            console.log(selectedData);
            var reqId = selectedData[1];
            console.log(reqId);
            $('#requestId').val(reqId);
            GetRequestForm();
        });
    });
</script>

<div id='myModal' class='modal fade'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>

@section scripts{
    @Scripts.Render("~/Scripts/Common/ModalPopup.js")
}

<script>
    function GetRequestForm() {
        var reqId = $('#requestId').val();
        $.ajax({
            cache: 'false',
            type: "Post",
            // contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetSelectedRequestForm", "Config")',

            dataType: 'json',  // add this line
            data: {
                reqId: reqId
            },
            success: function (vm) {

                $("#tbl_Request_RequestId").val(vm.RequestModel.RequestId);
                $("#tbl_Request_Part_No").val(vm.RequestModel.Part_No);
                $("#tbl_Request_Equipment_Name").val(vm.RequestModel.Equipment_Name);
                $("#tbl_Request_PMS_No").val(vm.RequestModel.PMS_No);
                $("#tbl_Request_NSN").val(vm.RequestModel.NSN);
                $("#tbl_Request_Country").val(vm.RequestModel.Country);
                $("#tbl_Request_ManufacturerName").val(vm.RequestModel.ManufacturerName);

                $("#tbl_Request_CageCode").val(vm.RequestModel.base64Pic);
                $("#tbl_Request_Qty").val(vm.RequestModel.Part_No);
                $("#tbl_Request_UNIT_PRICE").val(vm.RequestModel.PART_NAME);
                $("#tbl_Request_CurrencyID").val(vm.RequestModel.CageCode);
                $("#tbl_Request_MTBF").val(vm.RequestModel.CageName);
                $("#tbl_Request_BRF").val(vm.RequestModel.NSN);
                $("#tbl_Request_LOCATIONS").val(vm.RequestModel.PartTypeID);
        $("#tbl_Request_SERIAL_NO").val(vm.RequestModel.MCAT_ID);
        $("#tbl_Request_LENGTH").val(vm.RequestModel.LENGTH);
        $("#tbl_Request_WIDTH").val(vm.RequestModel.WIDTH);
        $("#tbl_Request_HEIGHT").val(vm.RequestModel.HEIGHT);
        $("#tbl_Request_DIAMETER").val(vm.RequestModel.WEIGHT);
        $("#tbl_Request_WEIGHT").val(vm.RequestModel.PART_CHARACTERISTIC);
        $("#tbl_Request_JUSTIFICATION").val(vm.RequestModel.MTBF);
        $("#tbl_Request_DETAIL_REMARKS").val(vm.RequestModel.MTTR);

    },
            failure: function (vm) {
                alert("failed! Call us Please.");
            },
            error: function (vm) {
                alert("failed! Error.");

            },
        });

    };

    function RegisterRequest() {
        var reqId = $("#tbl_Request_RequestId").val();
        alert(reqId);
        $.ajax({
                cache: 'false',
                type: "Post",
                // contentType: "application/json; charset=utf-8",
            url: '@Url.Action("RegisterRequest", "Config")',

            dataType: 'json',  // add this line
            data: {
                reqId: reqId
            },
            success: function (response) {
                alert("sucess");
            },
            failure: function (data) {
                alert("failed! Call us Please.");
            },
            error: function (data) {
                alert("failed! Error.");

            },
        });

    };

        function ReturnReq() {
            var reqId = $("#tbl_Request_RequestId").val();
            var remarks = $("#remarks").val();
        $.ajax({
                cache: 'false',
                type: "Post",
                // contentType: "application/json; charset=utf-8",
            url: '@Url.Action("ReturnRequest", "Config")',

            dataType: 'json',  // add this line
            data: {
                reqId: reqId,
                remarks: remarks,
            },
            success: function (response) {
                alert("sucess");
            },
            failure: function (data) {
                alert("failed! Call us Please.");
            },
            error: function (data) {
                alert("failed! Error.");

            },
        });

    };
</script>