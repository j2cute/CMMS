@model ClassLibrary.ViewModels.CageViewModels
@using CMMS.Web.Helper
@{
    var msg = TempData["notification"] != null ? TempData["notification"].ToString() : string.Empty;

}

<link href="~/Content/morris.css" rel="stylesheet" />
<link href="~/Content/Digtalstyle.css" rel="stylesheet" />
<script src="~/Content/Digitalscript.js"></script>
<script src="~/Scripts/moment.min.js"></script>
<script src="~/Scripts/raphael.min.js"></script>


<style>
    a {
        cursor: pointer;
    }

    td {
        font-size: 12px !important;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 4px 4px !important;
    }
</style>

<script>
    var permissions;
    $(document).ready(function () {


        permissions = @Html.Raw(Json.Encode(((SessionHelper)Session[SessionKeys.SessionHelperInstance]).CurrentRolePermissions));
        if (!permissions.filter(obj => obj.PermissionId == "ManAdd").length > 0) {
                $("#addCage").addClass('disabled')
            }

            var table;

            table= $('#example1').DataTable(
            {
            "bServerSide": true,
            "processing": true,
            "scrollX": true,
            "paging": true,
            "filter": true,
            "destroy": true,
            "order": [[1, 'asc']],
            "lengthMenu": [[10, 25, 50,100,-1], [10, 25,50,100, "All"]],
            ajax: {
                type: 'POST',
                url: '@Url.Action("LoadData")',
                dataType: 'json',
                dataSrc: 'data',
            },
            columns: [
                {
                    'data': function (data, type, row, meta) {
                        var actions = '';

                        if (permissions.filter(obj => obj.PermissionId == "ManEdit").length > 0) {
                            actions = '<a id="editCage" class="btn btn-primary btn-xs select" data-toggle="modal" data-target="myModal" href="/Cage/Edit/' + data.CageId + '"><i class="fa fa-pencil"></i >' + 'Edit' + '</a>';
                        }
                        else {
                            actions = '<a id="editCage" class="btn btn-primary btn-xs select disabled" data-toggle="modal" data-target="myModal" href="/Cage/Edit/' + data.CageId + '"><i class="fa fa-pencil"></i >' + 'Edit' + '</a>';
                       }

                        actions = actions + " " + '|' + " ";

                        if (permissions.filter(obj => obj.PermissionId == "ManDel").length > 0) {
                            actions = actions + '<a id="delCage" class="btn btn-danger btn-xs select" data-toggle="modal" href="/Cage/Delete/' + data.CageId + '">' + 'Delete' + '</a>';
                        }
                        else {
                            actions = actions + '<a id="delCage" class="btn btn-danger btn-xs select disabled" data-toggle="modal" href="/Cage/Delete/' + data.CageId + '">' + 'Delete' + '</a>';
                          }

                        return actions;
                    }
                },
                { 'data': 'CageCode', "name": "CageCode", },
                { 'data': 'CageName', "name": "CageName", },
                { 'data': 'Country', "name": "Country", },
                { 'data': 'Status', "name": "Status", },
                {
                    'data': function (data, type, row, meta) {
                        return '<a  class="btn-info btn-sm select" data-toggle="modal" data-target="myModal" href="/Cage/Details/' + data.CageId + '">' + 'Details' + '</a>';
                    }
                },
            ],
            "rowCallback": function (row, data, dataIndex) {
                if (data["Status"] == "InActive") {
                    $('td', row).css('background-color', 'red');
                }
            },

            });

        $('#example1 tbody').on("click", '.select', function () {
            var tblData = table.rows($(this).closest('tr')).data();

            $('#myModalContent').load(this.href, function (response, status, xhr) {

                if (status == "error") {

                    if (xhr) {
                        if (xhr.status == "403") {
                            alert("You are not authorized to perform this operation.");
                        }
                        else {
                            alert("Something went wrong.Please contact your system Administartor.");
                        }
                    }
                    else
                    {
                        alert("Something went wrong.Please contact your system Administartor.");
                    }
                } else {

                    $('#myModal').modal({

                        keyboard: true
                    }, 'show');
                }
            });
            });
            return false;
        });


</script>


<section class="content-header">
    <div class="container-fluid">
        <h1>
            Manufactures
        </h1>
    </div>
</section>
<!-- Main content -->
<section class="content" style="min-height:0px !important">

    @Html.Partial("_NotificationPanel")

    <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-4 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-red">
                    <div class="inner">
                        <h3>@Model.cageCount</h3>
                        <p>Total Manufacturer</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-industry"></i>
                    </div>

                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-4 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-green">
                    <div class="inner">
                        <h3>@Model.CageCountryCount<sup style="font-size: 20px"></sup></h3>
                        <p>Countries</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-map"></i>
                    </div>

                </div>
            </div>
            <!-- ./col -->
            <div class="col-lg-4 col-xs-6">
                <!-- small box -->
                <div class="small-box bg-blue">

                    <div class="inner">


                        <h3>@Model.cageActiveCount</h3>
                        <p>Active Manufacturer</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-industry"></i>
                    </div>

                </div>
            </div>

        </div>

        <div class="row">

        </div>
    </div>

</section>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <a id="addCage" class="btn btn-success" data-modal='' href="@Url.Action("Create", "Cage")"><i class="fa fa-plus"></i> Add New Record</a>
                    </div>
                    <!-- /.box-header -->
                    <div class="card-body">
                        <table id="example1" class="table table-bordered table-striped" width="100%">
                            <thead>
                                <tr>
                                    <th>Actions</th>
                                    <th>Cage Code</th>
                                    <th>Cage Name</th>

                                    <th>Country</th>
                                    <th>Status</th>
                                    <th></th>

                                </tr>
                            </thead>
                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>

            </div>
            <div class="col-md-4">


                <!-- /.box -->
                <!-- DONUT CHART -->
                <div class="box box-danger">
                    <div class="box-header with-border">
                        <h3 class="box-title"> </h3>
                        <br />
                        <br />
                        <br />
                        <div class="box-tools pull-right">

                        </div>
                    </div>
                    <div class="box-body chart-responsive">
                        <div class="chart" id="sales-chart" style="height: 300px; position: relative;"></div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
        </div>
    </div>
</section>


<div id='myModal' class='modal fade'>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id='myModalContent'>

            </div>
        </div>
    </div>
</div>

@section scripts{
    @Scripts.Render("~/Scripts/Common/ModalPopup.js")
}

<script src="~/Scripts/morris.min.js"></script>
<script>
    var dataSource = @Html.Raw(Json.Encode(Model.dataList));
    var donut = new Morris.Donut({

        element: 'sales-chart',
        resize: true,
        colors: ["#ff0000", "#54a460", "#1f67a5", "#54a460", "#008b8b", "#c0c0c0", "#8b4513", "#ff6347", "#bdb76b", "#000000", "#4169e1"],


        data: dataSource,
        hideHover: 'auto'
    });
</script>

